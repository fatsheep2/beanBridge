var f=Object.defineProperty;var g=(s,e,t)=>e in s?f(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>g(s,typeof e!="symbol"?e+"":e,t);import{y as c}from"./useDegWasm-B6iXPWHI.js";class d{constructor(){l(this,"STORAGE_KEY","beancount_yaml_configs");l(this,"HISTORY_KEY","beancount_yaml_config_history")}getConfig(e){try{const t=localStorage.getItem(this.STORAGE_KEY);return t&&JSON.parse(t)[e]||null}catch(t){return console.error("Failed to load YAML config:",t),null}}saveConfig(e,t){try{const r=localStorage.getItem(this.STORAGE_KEY),o=r?JSON.parse(r):{};o[e]=t,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o)),this.saveToHistory(e,t)}catch(r){console.error("Failed to save YAML config:",r)}}getDefaultConfig(e){const t={defaultMinusAccount:"Assets:FIXME",defaultPlusAccount:"Expenses:FIXME",defaultCommissionAccount:"Expenses:Commission:FIXME",defaultCurrency:"CNY",title:"BeanBridge 财务记录"};return t[e]={rules:[]},c.stringify(t,{indent:2,lineWidth:0,minContentWidth:0})}async loadFromExample(e){try{const r=await fetch(`/beanBridge/feat/blockchain-integration/example/${e}/config.yaml`);if(r.ok)return await r.text();const o=`https://raw.githubusercontent.com/deb-sig/double-entry-generator/master/example/${e}/config.yaml`,i=await fetch(o);return i.ok?await i.text():null}catch(t){return console.error("Failed to load example config:",t),null}}validateConfig(e){try{const t=c.parse(e);return!t||typeof t!="object"?{valid:!1,error:"配置必须是对象格式"}:t.defaultMinusAccount?t.defaultPlusAccount?t.defaultCurrency?{valid:!0,config:t}:{valid:!1,error:"缺少必需字段: defaultCurrency"}:{valid:!1,error:"缺少必需字段: defaultPlusAccount"}:{valid:!1,error:"缺少必需字段: defaultMinusAccount"}}catch(t){return{valid:!1,error:t instanceof Error?t.message:"YAML 解析失败"}}}exportConfig(e){return this.getConfig(e)}importConfig(e,t){return this.validateConfig(t).valid?(this.saveConfig(e,t),!0):!1}getHistory(e){try{const t=localStorage.getItem(this.HISTORY_KEY),r=t?JSON.parse(t):[];return e?r.filter(o=>o.provider===e):r}catch(t){return console.error("Failed to load history:",t),[]}}saveToHistory(e,t){try{const r=this.getHistory(),o={id:this.generateId(),provider:e,content:t,createdAt:new Date().toISOString()};r.unshift(o);const i=new Map;for(const n of r)i.has(n.provider)||i.set(n.provider,[]),i.get(n.provider).push(n);const a=[];for(const[,n]of i)a.push(...n.slice(0,5));a.sort((n,u)=>new Date(u.createdAt).getTime()-new Date(n.createdAt).getTime()),localStorage.setItem(this.HISTORY_KEY,JSON.stringify(a))}catch(r){console.error("Failed to save to history:",r)}}applyHistory(e){try{const r=this.getHistory().find(o=>o.id===e);return r?(this.saveConfig(r.provider,r.content),r.content):null}catch(t){return console.error("Failed to apply history:",t),null}}deleteHistory(e){try{const t=this.getHistory(),r=t.filter(o=>o.id!==e);return r.length===t.length?!1:(localStorage.setItem(this.HISTORY_KEY,JSON.stringify(r)),!0)}catch(t){return console.error("Failed to delete history:",t),!1}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}const m=new d;export{m as y};
