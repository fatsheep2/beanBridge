import{r as i,C as p,D as te,l as z,g as oe,d as N,e as v,T as Y,E as j,m as F,v as H,B as g,c as ne,o as ae,G as le,F as se,H as ce,I as re}from"./vendor-axiUcNeZ.js";import{t as P,h as K,n as k,T as _,a as ie,p as ue,q as M,c as X,u as $,e as A,s as de,i as G,w as U,j as x,v as ve,H as fe,I as ye,P as me}from"./index-DtV5s76x.js";import{u as he}from"./use-expose-DflG7Ynw.js";let Ie=2e3;const Oe=()=>++Ie,Ce={show:Boolean,zIndex:k,overlay:P,duration:k,teleport:[String,Object],lockScroll:P,lazyRender:P,beforeClose:Function,overlayProps:Object,overlayStyle:Object,overlayClass:K,transitionAppear:Boolean,closeOnClickOverlay:P};function Pe(e,t){return e>t?"horizontal":t>e?"vertical":""}function we(){const e=i(0),t=i(0),o=i(0),r=i(0),l=i(0),s=i(0),c=i(""),n=i(!0),f=()=>c.value==="vertical",C=()=>c.value==="horizontal",u=()=>{o.value=0,r.value=0,l.value=0,s.value=0,c.value="",n.value=!0};return{move:(d=>{const y=d.touches[0];o.value=(y.clientX<0?0:y.clientX)-e.value,r.value=y.clientY-t.value,l.value=Math.abs(o.value),s.value=Math.abs(r.value);const O=10;(!c.value||l.value<O&&s.value<O)&&(c.value=Pe(l.value,s.value)),n.value&&(l.value>_||s.value>_)&&(n.value=!1)}),start:(d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY}),reset:u,startX:e,startY:t,deltaX:o,deltaY:r,offsetX:l,offsetY:s,direction:c,isVertical:f,isHorizontal:C,isTap:n}}let w=0;const B="van-overflow-hidden";function Se(e,t){const o=we(),r="01",l="10",s=u=>{o.move(u);const I=o.deltaY.value>0?l:r,S=ue(u.target,e.value),{scrollHeight:d,offsetHeight:y,scrollTop:O}=S;let m="11";O===0?m=y>=d?"00":"01":O+y>=d&&(m="10"),m!=="11"&&o.isVertical()&&!(parseInt(m,2)&parseInt(I,2))&&M(u,!0)},c=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",s,{passive:!1}),w||document.body.classList.add(B),w++},n=()=>{w&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",s),w--,w||document.body.classList.remove(B))},f=()=>t()&&c(),C=()=>t()&&n();ie(f),p(C),te(C),z(t,u=>{u?c():n()})}function V(e){const t=i(!1);return z(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const L=()=>{var e;const{scopeId:t}=((e=oe())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[be,ke]=X("overlay"),Te={show:Boolean,zIndex:k,duration:k,className:K,lockScroll:P,lazyRender:P,customStyle:Object,teleport:[String,Object]};var xe=N({name:be,inheritAttrs:!1,props:Te,setup(e,{attrs:t,slots:o}){const r=i(),l=V(()=>e.show||!e.lazyRender),s=n=>{e.lockScroll&&M(n,!0)},c=l(()=>{var n;const f=A(de(e.zIndex),e.customStyle);return G(e.duration)&&(f.animationDuration=`${e.duration}s`),F(v("div",g({ref:r,style:f,class:[ke(),e.className]},t),[(n=o.default)==null?void 0:n.call(o)]),[[H,e.show]])});return $("touchmove",s,{target:r}),()=>{const n=v(Y,{name:"van-fade",appear:!0},{default:c});return e.teleport?v(j,{to:e.teleport},{default:()=>[n]}):n}}});const ge=U(xe),ze=A({},Ce,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Ae,R]=X("popup");var Ee=N({name:Ae,inheritAttrs:!1,props:ze,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:r}){let l,s;const c=i(),n=i(),f=V(()=>e.show||!e.lazyRender),C=ne(()=>{const a={zIndex:c.value};if(G(e.duration)){const h=e.position==="center"?"animationDuration":"transitionDuration";a[h]=`${e.duration}s`}return a}),u=()=>{l||(l=!0,c.value=e.zIndex!==void 0?+e.zIndex:Oe(),t("open"))},I=()=>{l&&ve(e.beforeClose,{done(){l=!1,t("close"),t("update:show",!1)}})},S=a=>{t("clickOverlay",a),e.closeOnClickOverlay&&I()},d=()=>{if(e.overlay){const a=A({show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},e.overlayProps);return v(ge,g(a,L(),{onClick:S}),{default:r["overlay-content"]})}},y=a=>{t("clickCloseIcon",a),I()},O=()=>{if(e.closeable)return v(ye,{role:"button",tabindex:0,name:e.closeIcon,class:[R("close-icon",e.closeIconPosition),fe],classPrefix:e.iconPrefix,onClick:y},null)};let m;const Z=()=>{m&&clearTimeout(m),m=setTimeout(()=>{t("opened")})},q=()=>t("closed"),W=a=>t("keydown",a),J=f(()=>{var a;const{destroyOnClose:h,round:T,position:b,safeAreaInsetTop:Q,safeAreaInsetBottom:ee,show:D}=e;if(!(!D&&h))return F(v("div",g({ref:n,style:C.value,role:"dialog",tabindex:0,class:[R({round:T,[b]:b}),{"van-safe-area-top":Q,"van-safe-area-bottom":ee}],onKeydown:W},o,L()),[(a=r.default)==null?void 0:a.call(r),O()]),[[H,D]])}),E=()=>{const{position:a,transition:h,transitionAppear:T}=e,b=a==="center"?"van-fade":`van-popup-slide-${a}`;return v(Y,{name:h||b,appear:T,onAfterEnter:Z,onAfterLeave:q},{default:J})};return z(()=>e.show,a=>{a&&!l&&(u(),o.tabindex===0&&ce(()=>{var h;(h=n.value)==null||h.focus()})),!a&&l&&(l=!1,t("close"))}),he({popupRef:n}),Se(n,()=>e.show&&e.lockScroll),$("popstate",()=>{e.closeOnPopstate&&(I(),s=!1)}),ae(()=>{e.show&&u()}),le(()=>{s&&(t("update:show",!0),s=!1)}),p(()=>{e.show&&e.teleport&&(I(),s=!0)}),re(me,()=>e.show),()=>e.teleport?v(j,{to:e.teleport},{default:()=>[d(),E()]}):v(se,null,[d(),E()])}});const Le=U(Ee);export{Le as P,we as a,L as u};
