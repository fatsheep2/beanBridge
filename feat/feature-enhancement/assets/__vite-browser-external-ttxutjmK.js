var y=Object.defineProperty;var h=(c,t,e)=>t in c?y(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var l=(c,t,e)=>h(c,typeof t!="symbol"?t+"":t,e);import{P as i}from"./ProviderSelector.vue_vue_type_script_setup_true_lang-C1T66vTm.js";import{_ as p}from"./index-_74JWetZ.js";class d{static getBasePath(){return"/beanBridge/feat/feature-enhancement/example"}static async getPresetConfig(t){if(this.configCache.has(t))return this.configCache.get(t);try{const e=await this.loadConfigFromFile(t);return e&&this.configCache.set(t,e),e}catch(e){return console.error(`[PresetConfigService] 加载预设配置失败 (${t}):`,e),null}}static async getAllPresetConfigs(){const t=this.getSupportedProviders(),e=[];for(const r of t)try{const o=await this.getPresetConfig(r);o&&e.push(o)}catch(o){console.warn(`[PresetConfigService] 跳过加载失败的配置 (${r}):`,o)}return e}static async loadConfigFromFile(t){const e=`${this.getBasePath()}/${t}/config.json`;try{return typeof window>"u"?await this.loadConfigFromFileSystem(t):await this.loadConfigFromFetch(e)}catch(r){return console.error(`[PresetConfigService] 读取配置文件失败: ${e}`,r),null}}static async loadConfigFromFileSystem(t){try{const{readFileSync:e,existsSync:r}=await p(async()=>{const{readFileSync:u,existsSync:f}=await Promise.resolve().then(()=>g);return{readFileSync:u,existsSync:f}},void 0),{join:o}=await p(async()=>{const{join:u}=await Promise.resolve().then(()=>g);return{join:u}},void 0),n=o(process.cwd(),"public","example",t,"config.json");if(!r(n))return console.warn(`[PresetConfigService] 配置文件不存在: ${n}`),null;const s=e(n,"utf-8"),a=JSON.parse(s);return this.validateConfig(a)?a:(console.error(`[PresetConfigService] 配置文件格式无效: ${n}`),null)}catch(e){return console.error("[PresetConfigService] 文件系统读取失败:",e),null}}static async loadConfigFromFetch(t){try{const e=await fetch(t);if(!e.ok)return console.warn(`[PresetConfigService] 配置文件不存在: ${t}`),null;const r=await e.json();return this.validateConfig(r)?r:(console.error(`[PresetConfigService] 配置文件格式无效: ${t}`),null)}catch(e){return console.error("[PresetConfigService] fetch 读取失败:",e),null}}static validateConfig(t){return t&&typeof t.provider=="string"&&typeof t.name=="string"&&typeof t.description=="string"&&t.config&&typeof t.config.defaultCurrency=="string"&&Array.isArray(t.config.rules)}static getSupportedProviders(){return[i.Alipay,i.Wechat,i.Jd,i.MT,i.CCB,i.Icbc,i.Td,i.Citic,i.Bmo,i.HsbcHK,i.Htsec,i.Huobi,i.Ethereum,i.BinanceSmartChain,i.Polygon,i.Arbitrum,i.Optimism,i.Avalanche,i.Solana,i.Bitcoin]}static clearCache(){this.configCache.clear()}static async hasPresetConfig(t){return await this.getPresetConfig(t)!==null}static async getStatistics(){const t=this.getSupportedProviders(),e=[],r=[];for(const o of t){const n=await this.getPresetConfig(o);n?e.push(n):r.push(o)}return{totalProviders:t.length,availableConfigs:e.length,missingConfigs:r}}}l(d,"configCache",new Map);const m=[{provider:i.Alipay,name:"支付宝基础配置",description:"支付宝交易记录的基础配置模板",config:{defaultMinusAccount:"Assets:FIXME",defaultPlusAccount:"Expenses:FIXME",defaultCurrency:"CNY",rules:[{name:"余额支付方式",description:"使用余额支付时，资金账户为支付宝余额",method:"余额",fullMatch:!0,methodAccount:"Assets:Alipay",priority:1},{name:"余额宝支付方式",description:"使用余额宝支付时，资金账户为支付宝余额宝",method:"余额宝",fullMatch:!0,methodAccount:"Assets:Alipay",priority:2},{name:"银行卡支付方式",description:"使用银行卡支付时，资金账户为对应银行账户",method:"招商银行(9876)",fullMatch:!0,methodAccount:"Assets:Bank:CN:CMB-9876:Savings",priority:3},{name:"餐饮午餐",description:"11:00-14:00的餐饮消费归类为午餐",category:"餐饮美食",type:"支出",time:"11:00-14:00",targetAccount:"Expenses:Food:Lunch",priority:4},{name:"餐饮晚餐",description:"16:00-22:00的餐饮消费归类为晚餐",category:"餐饮美食",type:"支出",time:"16:00-22:00",targetAccount:"Expenses:Food:Dinner",priority:5},{name:"日用百货",description:"日用百货消费归类为杂货",category:"日用百货",type:"支出",targetAccount:"Expenses:Groceries",priority:6},{name:"苏宁购物",description:"苏宁购物归类为电子产品",peer:"苏宁",type:"支出",targetAccount:"Expenses:Electronics",priority:7},{name:"相互宝保险",description:"相互宝费用归类为保险",item:"相互宝",type:"支出",targetAccount:"Expenses:Insurance",priority:8},{name:"收入转账",description:"其他转账收款归类为收入",type:"收入",targetAccount:"Income:FIXME",methodAccount:"Assets:Alipay",priority:9},{name:"收款码收入",description:"收款码收款归类为支付宝收款码收入",type:"收入",item:"商品",targetAccount:"Income:Alipay:ShouKuanMa",methodAccount:"Assets:Alipay",priority:10}]}},{provider:i.Wechat,name:"微信支付基础配置",description:"微信支付交易记录的基础配置模板",config:{defaultMinusAccount:"Assets:FIXME",defaultPlusAccount:"Expenses:FIXME",defaultCommissionAccount:"Expenses:Commission:FIXME",defaultCurrency:"CNY",rules:[{name:"零钱支付方式",description:"使用零钱支付时，资金账户为零钱",method:"零钱",fullMatch:!0,methodAccount:"Assets:Digital:Wechat:Cash",priority:1},{name:"零钱通支付方式",description:"使用零钱通支付时，资金账户为零钱通",method:"零钱通",fullMatch:!0,methodAccount:"Assets:Digital:Wechat:MiniFund",priority:2},{name:"微信红包收入",description:"微信红包收入归类为红包收入",type:"收入",method:"/",item:"/",targetAccount:"Income:Wechat:RedPacket",priority:3},{name:"转入零钱通",description:"转入零钱通操作",txType:"转入零钱通",peer:"/",item:"/",targetAccount:"Assets:Digital:Wechat:MiniFund",priority:4},{name:"零钱提现",description:"零钱提现操作",txType:"零钱提现",targetAccount:"Assets:Digital:Wechat:Cash",commissionAccount:"Expenses:Wechat:Commission",priority:5},{name:"零钱充值",description:"零钱充值操作",txType:"零钱充值",targetAccount:"Assets:Digital:Wechat:Cash",priority:6},{name:"餐饮午餐",description:"11:00-15:00的餐饮消费归类为午餐",peer:"云膳过桥米线,餐厅",sep:",",time:"11:00-15:00",targetAccount:"Expenses:Food:Meal:Lunch",priority:7},{name:"餐饮晚餐",description:"16:30-21:30的餐饮消费归类为晚餐",peer:"云膳过桥米线,餐厅",sep:",",time:"16:30-21:30",targetAccount:"Expenses:Food:Meal:Dinner",priority:8},{name:"房东租金",description:"房东相关支出归类为房租",peer:"房东",type:"支出",targetAccount:"Expenses:Housing:Rent",priority:9},{name:"用户收入",description:"用户相关收入归类为服务收入",peer:"用户",type:"收入",targetAccount:"Income:Service",priority:10}]}},{provider:i.CCB,name:"建设银行基础配置",description:"建设银行交易记录的基础配置模板",config:{defaultMinusAccount:"Assets:FIXME",defaultPlusAccount:"Expenses:FIXME",defaultCurrency:"CNY",rules:[{name:"工资收入",description:"工资收入归类为工资收入",type:"收入",peer:"工资",targetAccount:"Income:Salary",methodAccount:"Assets:Bank:CN:CCB:Savings",priority:1},{name:"转账收入",description:"转账收入归类为其他收入",type:"收入",targetAccount:"Income:FIXME",methodAccount:"Assets:Bank:CN:CCB:Savings",priority:2},{name:"餐饮消费",description:"餐饮相关消费归类为餐饮",category:"餐饮",type:"支出",targetAccount:"Expenses:Food",methodAccount:"Assets:Bank:CN:CCB:Savings",priority:3},{name:"购物消费",description:"购物相关消费归类为购物",category:"购物",type:"支出",targetAccount:"Expenses:Shopping",methodAccount:"Assets:Bank:CN:CCB:Savings",priority:4},{name:"交通消费",description:"交通相关消费归类为交通",category:"交通",type:"支出",targetAccount:"Expenses:Transport",methodAccount:"Assets:Bank:CN:CCB:Savings",priority:5},{name:"转账支出",description:"转账支出归类为其他支出",type:"支出",targetAccount:"Expenses:FIXME",methodAccount:"Assets:Bank:CN:CCB:Savings",priority:6}]}}],A=async c=>{const t=await d.getPresetConfig(c);return t||m.find(e=>e.provider===c)};class C{constructor(){l(this,"STORAGE_KEY","beancount_rule_configs");l(this,"HISTORY_KEY","beancount_config_history")}getConfig(t){return this.getAllConfigs()[t]||null}getAllConfigs(){try{const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Failed to load configs from localStorage:",t),{}}}saveConfig(t){try{const e=this.getAllConfigs();e[t.provider]={...t,updatedAt:new Date().toISOString()},localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),this.saveToHistory(t)}catch(e){console.error("Failed to save config:",e)}}deleteConfig(t){try{const e=this.getAllConfigs();delete e[t],localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Failed to delete config:",e)}}async createFromPreset(t,e){const r=await A(t);if(!r)throw new Error(`No preset config found for provider: ${t}`);const o=new Date().toISOString();return{id:this.generateId(),provider:t,name:e,description:r.description,createdAt:o,updatedAt:o,...r.config,rules:r.config.rules.map((s,a)=>({...s,id:this.generateId(),priority:a+1}))}}getHistory(t){try{const e=localStorage.getItem(this.HISTORY_KEY),r=e?JSON.parse(e):[];return t?r.filter(o=>o.provider===t):r}catch(e){return console.error("Failed to load history from localStorage:",e),[]}}deleteHistory(t){try{const e=this.getHistory(),r=e.filter(o=>o.id!==t);return r.length===e.length?!1:(this.updateHistory(r),!0)}catch(e){return console.error("Failed to delete history:",e),!1}}deleteProviderHistory(t){try{const e=this.getHistory(),r=e.filter(o=>o.provider!==t);return r.length===e.length?!1:(this.updateHistory(r),!0)}catch(e){return console.error("Failed to delete provider history:",e),!1}}applyHistory(t){try{const e=this.getHistory(),r=e.find(o=>o.id===t);return r?(r.appliedAt=new Date().toISOString(),this.updateHistory(e),this.saveConfig(r.config),r.config):null}catch(e){return console.error("Failed to apply history:",e),null}}exportToClipboard(t){return new Promise(e=>{try{const r=this.getConfig(t);if(!r){e(!1);return}const o=JSON.stringify(r,null,2);navigator.clipboard.writeText(o).then(()=>{e(!0)}).catch(()=>{e(!1)})}catch(r){console.error("Failed to export config:",r),e(!1)}})}importFromClipboard(){return new Promise(t=>{try{navigator.clipboard.readText().then(e=>{try{const r=JSON.parse(e);if(!this.validateConfig(r)){t(null);return}r.updatedAt=new Date().toISOString(),r.rules=r.rules.map(o=>({...o,id:o.id||this.generateId()})),this.saveConfig(r),t(r)}catch(r){console.error("Failed to parse clipboard content:",r),t(null)}}).catch(()=>{t(null)})}catch(e){console.error("Failed to import config:",e),t(null)}})}validateConfig(t){return t&&typeof t=="object"&&typeof t.provider=="string"&&typeof t.name=="string"&&typeof t.defaultMinusAccount=="string"&&typeof t.defaultPlusAccount=="string"&&typeof t.defaultCurrency=="string"&&Array.isArray(t.rules)}saveToHistory(t){try{const e=this.getHistory(),r={id:this.generateId(),provider:t.provider,name:t.name,config:{...t},createdAt:new Date().toISOString()};e.unshift(r);const o=new Map;for(const s of e)o.has(s.provider)||o.set(s.provider,[]),o.get(s.provider).push(s);const n=[];for(const[s,a]of o)n.push(...a.slice(0,5));n.sort((s,a)=>new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()),this.updateHistory(n)}catch(e){console.error("Failed to save to history:",e)}}updateHistory(t){try{localStorage.setItem(this.HISTORY_KEY,JSON.stringify(t))}catch(e){console.error("Failed to update history:",e)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}}const F=new C,g=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{F as r};
