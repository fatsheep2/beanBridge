import{d as U,r as u,i as X,c as o,a as t,b as v,n as F,t as l,e as c,F as z,j as N,k as E,v as $,l as P,g as G,w as O,h as H,o as n,u as q}from"./vendor-z8y3CHRY.js";const K={class:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8"},J={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Q={class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},Z={class:"flex items-center justify-between"},ee={class:"flex items-center space-x-4"},te={class:"flex items-center"},re={key:0,class:"flex items-center"},se=["disabled"],ae={key:0,class:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg"},oe={class:"flex items-center"},le={class:"text-red-800 dark:text-red-200 text-sm"},ne={class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},de={key:0,class:"text-gray-500 dark:text-gray-400 text-sm mb-4"},ie={key:1,class:"grid grid-cols-2 md:grid-cols-4 gap-3"},ue=["onClick"],ce={key:2,class:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg"},me={class:"text-sm text-blue-800 dark:text-blue-200"},ge={class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},xe={class:"flex items-center justify-between mb-4"},be={class:"flex space-x-2"},pe=["disabled"],ve={key:0,class:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg"},ye={class:"flex items-center"},fe={class:"text-red-800 dark:text-red-200 text-sm"},we={key:1,class:"mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700 rounded-lg"},ke={class:"flex items-center"},he={class:"text-green-800 dark:text-green-200 text-sm"},_e={class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},Ce={class:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:border-blue-400 dark:hover:border-blue-500 transition-colors"},Me={class:"flex flex-col items-center"},Ae={key:0,class:"mt-4 p-4 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700"},Fe={class:"flex items-center justify-between"},Ee={class:"flex-1"},Se={class:"text-sm font-medium text-gray-900 dark:text-white mb-1"},Pe={class:"text-xs text-gray-600 dark:text-gray-400"},We={class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},Ie={class:"flex space-x-6"},Le={class:"flex items-center space-x-2 cursor-pointer"},Te={class:"flex items-center space-x-2 cursor-pointer"},je={class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},Be=["disabled"],Re={key:0,class:"material-icons mr-2"},Ve={key:1,class:"material-icons mr-2 animate-spin"},Ye={key:0,class:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg"},De={class:"flex items-center"},Ue={class:"text-red-800 dark:text-red-200 text-sm"},Xe={key:0,class:"mb-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6"},ze={class:"mb-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700"},Ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},$e={class:"ml-2 font-medium text-gray-900 dark:text-white"},Ge={class:"ml-2 font-medium text-gray-900 dark:text-white"},Oe={class:"ml-2 font-medium text-gray-900 dark:text-white"},He={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700 text-sm overflow-x-auto max-h-96 overflow-y-auto font-mono text-gray-900 dark:text-gray-100"},qe={class:"text-center"},Qe=U({__name:"DegTestView",setup(Ke){q();const m=u(!1),C=u(!1),w=u(null),M=u([]),g=u(""),y=u(`defaultMinusAccount: Assets:FIXME
defaultPlusAccount: Expenses:FIXME
defaultCurrency: CNY
title: 测试配置

alipay:
  rules:
    - category: 餐饮美食
      targetAccount: Expenses:Food
    - peer: 滴滴
      targetAccount: Expenses:Transport:Taxi
`),x=u(null),k=u(null),A=u(),b=u(null),f=u("beancount"),_=u(!1),d=u(null),a=u(null),W=async()=>{C.value=!0,w.value=null;try{const r=await fetch("/wasm/wasm_exec.js",{method:"HEAD"}).catch(()=>null);if(!r||!r.ok)throw new Error("WASM 文件未找到。请确保已运行 `npm run copy-wasm` 或 `pnpm run copy-wasm` 复制 WASM 文件到 public/wasm/ 目录");window.Go||await I("/wasm/wasm_exec.js");const e=await fetch("/wasm/double-entry-generator.wasm",{method:"HEAD"}).catch(()=>null);if(!e||!e.ok)throw new Error("WASM 二进制文件未找到。请确保已构建 double-entry-generator 的 WASM 版本");const i=new window.Go,s=await fetch("/wasm/double-entry-generator.wasm");if(!s.ok)throw new Error(`无法加载 WASM 文件: ${s.statusText}`);const h=await WebAssembly.instantiateStreaming(s,i.importObject);if(i.run(h.instance),await new Promise(p=>setTimeout(p,100)),m.value=!0,window.getSupportedProviders){const p=await window.getSupportedProviders();p.success&&p.providers&&(M.value=p.providers,p.providers.length>0&&(g.value=p.providers[0],window.setProvider&&await window.setProvider(p.providers[0])))}else M.value=["alipay","wechat","icbc","ccb","citic","cmb","huobi","htsec","hxsec","mt","jd","bmo","td","hsbchk"],g.value="alipay",window.setProvider&&await window.setProvider("alipay")}catch(r){console.error("WASM 初始化失败:",r),w.value=r instanceof Error?r.message:String(r),m.value=!1}finally{C.value=!1}},I=r=>new Promise((e,i)=>{if(document.querySelector(`script[src="${r}"]`)){e();return}const s=document.createElement("script");s.src=r,s.onload=()=>e(),s.onerror=h=>i(new Error(`Failed to load script: ${r}`)),document.head.appendChild(s)}),L=async r=>{if(g.value=r,window.setProvider)try{const e=await window.setProvider(r);e.success||(w.value=e.error||"设置 Provider 失败")}catch(e){w.value=e.message||"设置 Provider 失败"}},T=()=>{y.value=`defaultMinusAccount: Assets:FIXME
defaultPlusAccount: Expenses:FIXME
defaultCurrency: CNY
title: 示例配置

alipay:
  rules:
    - category: 餐饮美食
      targetAccount: Expenses:Food
    - peer: 滴滴
      targetAccount: Expenses:Transport:Taxi
`},S=async()=>{if(!y.value.trim()){x.value="配置不能为空";return}if(x.value=null,k.value=null,window.parseYamlConfig)try{const r=await window.parseYamlConfig(y.value);r.success?(k.value=r.message||"配置解析成功",x.value=null):(x.value=r.error||"配置解析失败",k.value=null)}catch(r){x.value=r.message||"配置解析失败",k.value=null}else x.value="WASM 未初始化或 parseYamlConfig 函数不可用"},j=r=>{const e=r.target;e.files&&e.files[0]&&(b.value=e.files[0],d.value=null,a.value=null)},B=()=>{A.value&&(A.value.value=""),b.value=null,d.value=null,a.value=null},R=r=>{if(r===0)return"0 Bytes";const e=1024,i=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,s)).toFixed(2))+" "+i[s]},V=async()=>{if(!m.value){d.value="请先初始化 WASM";return}if(!g.value){d.value="请先选择 Provider";return}if(!b.value){d.value="请先选择文件";return}if(y.value.trim()&&(await S(),x.value)){d.value="配置解析失败，请检查配置";return}_.value=!0,d.value=null,a.value=null;try{const r="tempWasmFileInput",e=document.createElement("input");e.type="file",e.id=r;const i=new DataTransfer;i.items.add(b.value),e.files=i.files,document.body.appendChild(e);try{if(window.processFileFromInputWithFormat){const s=await window.processFileFromInputWithFormat(r,f.value);s.success?(a.value=s,d.value=null):(d.value=s.error||"处理文件失败",a.value=null)}else d.value="WASM 函数 processFileFromInputWithFormat 不可用"}finally{document.body.removeChild(e)}}catch(r){console.error("处理文件失败:",r),d.value=r.message||"处理文件失败",a.value=null}finally{_.value=!1}},Y=async()=>{var r;if((r=a.value)!=null&&r.output)try{await navigator.clipboard.writeText(a.value.output),alert("已复制到剪贴板！")}catch(e){console.error("复制失败:",e),alert("复制失败")}},D=()=>{var h;if(!((h=a.value)!=null&&h.output)){d.value="没有可下载的数据";return}const r=f.value==="beancount"?"beancount":"ledger",e=new Blob([a.value.output],{type:"text/plain"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=`output.${r}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)};return X(()=>{}),(r,e)=>{const i=H("router-link");return n(),o("div",K,[t("div",J,[e[33]||(e[33]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-extrabold text-gray-900 dark:text-white mb-2"},"DEG WASM 完整功能测试"),t("p",{class:"text-gray-600 dark:text-gray-400"},"测试 YAML 配置、文件上传和解析的完整流程")],-1)),t("div",Q,[t("div",Z,[t("div",null,[e[5]||(e[5]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},"WASM 状态",-1)),t("div",ee,[t("div",te,[t("span",{class:F(["material-icons mr-2",m.value?"text-green-500":"text-gray-400"])},l(m.value?"check_circle":"radio_button_unchecked"),3),t("span",{class:F(["text-sm",m.value?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"])},l(m.value?"已初始化":"未初始化"),3)]),C.value?(n(),o("div",re,e[4]||(e[4]=[t("span",{class:"material-icons mr-2 animate-spin text-blue-500"},"refresh",-1),t("span",{class:"text-sm text-blue-600 dark:text-blue-400"},"初始化中...",-1)]))):v("",!0)])]),t("button",{onClick:W,disabled:C.value||m.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition-all"},e[6]||(e[6]=[t("span",{class:"material-icons mr-2"},"play_arrow",-1),c(" 初始化 WASM ")]),8,se)]),w.value?(n(),o("div",ae,[t("div",oe,[e[7]||(e[7]=t("span",{class:"material-icons text-red-600 dark:text-red-400 mr-2"},"error",-1)),t("span",le,l(w.value),1)])])):v("",!0)]),t("div",ne,[e[9]||(e[9]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"},"步骤 1: 选择 Provider",-1)),M.value.length===0?(n(),o("div",de," 请先初始化 WASM ")):(n(),o("div",ie,[(n(!0),o(z,null,N(M.value,s=>(n(),o("button",{key:s,onClick:h=>L(s),class:F(["px-4 py-3 rounded-lg font-medium transition-all",g.value===s?"bg-blue-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},l(s),11,ue))),128))])),g.value?(n(),o("div",ce,[t("span",me,[e[8]||(e[8]=c("当前选择: ")),t("strong",null,l(g.value),1)])])):v("",!0)]),t("div",ge,[t("div",xe,[e[12]||(e[12]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"步骤 2: YAML 配置",-1)),t("div",be,[t("button",{onClick:T,class:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium shadow-md transition-all text-sm"},e[10]||(e[10]=[t("span",{class:"material-icons mr-2 text-sm"},"file_download",-1),c(" 加载示例 ")])),t("button",{onClick:S,disabled:!y.value.trim(),class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition-all text-sm"},e[11]||(e[11]=[t("span",{class:"material-icons mr-2 text-sm"},"check_circle",-1),c(" 解析配置 ")]),8,pe)])]),E(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),class:"w-full h-64 p-4 font-mono text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 resize-none",placeholder:"请输入 YAML 配置..."},null,512),[[$,y.value]]),x.value?(n(),o("div",ve,[t("div",ye,[e[13]||(e[13]=t("span",{class:"material-icons text-red-600 dark:text-red-400 mr-2"},"error",-1)),t("span",fe,l(x.value),1)])])):v("",!0),k.value?(n(),o("div",we,[t("div",ke,[e[14]||(e[14]=t("span",{class:"material-icons text-green-600 dark:text-green-400 mr-2"},"check_circle",-1)),t("span",he,l(k.value),1)])])):v("",!0)]),t("div",_e,[e[20]||(e[20]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"},"步骤 3: 上传账单文件",-1)),t("div",Ce,[t("input",{type:"file",ref_key:"fileInput",ref:A,onChange:j,accept:".csv,.xls,.xlsx",class:"hidden"},null,544),t("div",Me,[e[16]||(e[16]=t("span",{class:"material-icons text-4xl text-gray-400 dark:text-gray-500 mb-4"},"cloud_upload",-1)),t("button",{onClick:e[1]||(e[1]=()=>{var s;return(s=A.value)==null?void 0:s.click()}),class:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-all mb-3"},e[15]||(e[15]=[t("span",{class:"material-icons mr-2"},"folder_open",-1),c(" 选择文件 ")])),e[17]||(e[17]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," 支持的文件格式: CSV, XLS, XLSX ",-1))])]),b.value?(n(),o("div",Ae,[t("div",Fe,[t("div",Ee,[t("p",Se,[e[18]||(e[18]=t("span",{class:"material-icons text-sm mr-1 align-middle"},"description",-1)),c(" "+l(b.value.name),1)]),t("p",Pe," 大小: "+l(R(b.value.size)),1)]),t("button",{onClick:B,class:"ml-4 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"清除文件"},e[19]||(e[19]=[t("span",{class:"material-icons"},"close",-1)]))])])):v("",!0)]),t("div",We,[e[23]||(e[23]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"},"步骤 4: 选择输出格式",-1)),t("div",Ie,[t("label",Le,[E(t("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),value:"beancount",class:"w-4 h-4 text-blue-600 focus:ring-blue-500"},null,512),[[P,f.value]]),e[21]||(e[21]=t("span",{class:"text-gray-700 dark:text-gray-300 font-medium"},"Beancount",-1))]),t("label",Te,[E(t("input",{type:"radio","onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),value:"ledger",class:"w-4 h-4 text-blue-600 focus:ring-blue-500"},null,512),[[P,f.value]]),e[22]||(e[22]=t("span",{class:"text-gray-700 dark:text-gray-300 font-medium"},"Ledger",-1))])])]),t("div",je,[e[25]||(e[25]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-4"},"步骤 5: 处理文件",-1)),t("button",{onClick:V,disabled:!m.value||!g.value||!b.value||_.value,class:"inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow-md disabled:opacity-50 disabled:cursor-not-allowed transition-all"},[_.value?(n(),o("span",Ve,"refresh")):(n(),o("span",Re,"play_arrow")),c(" "+l(_.value?"处理中...":"开始处理"),1)],8,Be),d.value?(n(),o("div",Ye,[t("div",De,[e[24]||(e[24]=t("span",{class:"material-icons text-red-600 dark:text-red-400 mr-2"},"error",-1)),t("span",Ue,l(d.value),1)])])):v("",!0)]),a.value&&a.value.success?(n(),o("div",Xe,[t("div",{class:"flex items-center justify-between mb-4"},[e[28]||(e[28]=t("h2",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"步骤 6: 处理结果",-1)),t("div",{class:"flex gap-2"},[t("button",{onClick:Y,class:"inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium transition-all"},e[26]||(e[26]=[t("span",{class:"material-icons mr-2 text-sm"},"content_copy",-1),c(" 复制 ")])),t("button",{onClick:D,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-all"},e[27]||(e[27]=[t("span",{class:"material-icons mr-2 text-sm"},"download",-1),c(" 下载 ")]))])]),t("div",ze,[t("div",Ne,[t("div",null,[e[29]||(e[29]=t("span",{class:"text-gray-600 dark:text-gray-400"},"格式:",-1)),t("span",$e,l(a.value.format||f.value),1)]),t("div",null,[e[30]||(e[30]=t("span",{class:"text-gray-600 dark:text-gray-400"},"交易数:",-1)),t("span",Ge,l(a.value.transactions||0),1)]),t("div",null,[e[31]||(e[31]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Provider:",-1)),t("span",Oe,l(a.value.provider||g.value),1)])])]),t("pre",He,l(a.value.output),1)])):v("",!0),t("div",qe,[G(i,{to:"/",class:"inline-flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-semibold shadow-md transition-all"},{default:O(()=>e[32]||(e[32]=[t("span",{class:"material-icons mr-2"},"arrow_back",-1),c(" 返回首页 ")])),_:1,__:[32]})])])])}}});export{Qe as default};
