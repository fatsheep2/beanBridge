import{r as z,d as W,f as m,c as g,a as e,b as h,t as c,A as B,B as G,F as T,s as D,o as d,g as J,x as K,k as U,i as N,w as Q,e as S,j as Y,n as O,C as H,h as ee,y as te}from"./vendor-l2xnFMpr.js";import{u as Z,y as V}from"./useDegWasm-B6iXPWHI.js";import"./wasm-DmpUyrXp.js";import{y as F}from"./yaml-config-service-4-EGGEDB.js";import{p as q,_ as re}from"./ProviderSelector.vue_vue_type_script_setup_true_lang-rH6YTlbh.js";import{_ as oe}from"./FileUploadSection.vue_vue_type_script_setup_true_lang-CnvM1e--.js";function se(){const $=Z(),j=z(null),M=z(!1),l=z(null),i=z(null),k=z("beancount"),n=async(w,b="beancount")=>{if(!$.currentProvider.value){i.value="ËØ∑ÂÖàÈÄâÊã©Ëß£ÊûêÂô®";return}M.value=!0,i.value=null,l.value=null;try{$.isInitialized.value||await $.init(),console.log(`[useDegFileProcessing] Â§ÑÁêÜÊñá‰ª∂ÔºåÂΩìÂâç provider: ${$.currentProvider.value}`),await $.setProvider($.currentProvider.value),await new Promise(C=>setTimeout(C,150));const x=await $.processFile(w,b);x.success?(l.value=x,i.value=null):(i.value=x.error||"Â§ÑÁêÜÊñá‰ª∂Â§±Ë¥•",l.value=null)}catch(x){console.error("Êñá‰ª∂Â§ÑÁêÜÂ§±Ë¥•:",x),i.value=x instanceof Error?x.message:"Â§ÑÁêÜÊñá‰ª∂Â§±Ë¥•",l.value=null}finally{M.value=!1}};return{selectedFile:j,isProcessing:M,processingResult:l,error:i,outputFormat:k,processFile:n,previewFile:async w=>{await n(w,k.value)},reset:()=>{j.value=null,l.value=null,i.value=null,M.value=!1},downloadResult:w=>{var R;if(!((R=l.value)!=null&&R.output)){i.value="Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑÊï∞ÊçÆ";return}const b=new Blob([l.value.output],{type:"text/plain"}),x=URL.createObjectURL(b),C=document.createElement("a");C.href=x,C.download=w||`beancount_${new Date().toISOString().split("T")[0]}.beancount`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(x)},copyToClipboard:async w=>{try{return await navigator.clipboard.writeText(w),!0}catch(b){return console.error("Â§çÂà∂Â§±Ë¥•:",b),!1}}}}const le={class:"rule-match-analysis bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mt-6"},ae={class:"flex items-center justify-between mb-6"},ne={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ie={class:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-5 border border-blue-200 dark:border-blue-700"},de={class:"flex items-center justify-between"},ue={class:"text-3xl font-bold text-blue-900 dark:text-blue-100"},ce={class:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-5 border border-green-200 dark:border-green-700"},ge={class:"flex items-center justify-between"},ve={class:"text-3xl font-bold text-green-900 dark:text-green-100"},me={class:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-xl p-5 border border-yellow-200 dark:border-yellow-700"},pe={class:"flex items-center justify-between"},be={class:"text-3xl font-bold text-yellow-900 dark:text-yellow-100"},xe={class:"bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-5 border border-red-200 dark:border-red-700"},fe={class:"flex items-center justify-between"},ye={class:"text-3xl font-bold text-red-900 dark:text-red-100"},he={class:"bg-gray-50 dark:bg-gray-900/50 rounded-xl p-5 mb-6"},ke={class:"flex items-center justify-between mb-3"},we={class:"relative w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},_e={class:"text-sm text-gray-600 dark:text-gray-400 mt-2"},Ce={key:0,class:"mb-6"},$e={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 max-h-[600px] overflow-y-auto"},Me={class:"flex items-center justify-between mb-3"},Pe={class:"text-sm text-gray-600 dark:text-gray-400 font-mono"},Re={class:"mb-3 pb-3 border-b border-gray-200 dark:border-gray-700"},Be={class:"flex items-start gap-2 mb-2"},je={class:"flex-1 min-w-0"},Se={class:"text-sm font-semibold text-gray-900 dark:text-white truncate"},Fe={key:0,class:"text-xs text-gray-600 dark:text-gray-400 truncate"},ze={class:"space-y-2 mb-3"},Ae=["onClick","title"],Te={key:0,class:"text-xs"},De={class:"cursor-pointer text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 select-none"},Ve={class:"mt-2 space-y-1 pl-4 border-l-2 border-gray-300 dark:border-gray-600"},Ee={class:"text-gray-500 dark:text-gray-500 font-semibold min-w-[80px]"},Ie={class:"text-gray-700 dark:text-gray-300 break-all"},Le={key:1,class:"bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-700 rounded-xl p-5"},Xe={class:"space-y-2"},Ue={class:"inline-block w-5 h-5 bg-yellow-400 dark:bg-yellow-600 rounded-full flex-shrink-0 flex items-center justify-center text-white font-bold text-xs mt-0.5"},Ne={key:2,class:"bg-green-50 dark:bg-green-900/10 border border-green-200 dark:border-green-700 rounded-xl p-6 text-center"},Oe=W({__name:"RuleMatchAnalysis",props:{processedData:{},totalRecords:{}},emits:["close"],setup($,{emit:j}){const M=$,l=m(()=>{var a;if(console.log("[RuleMatchAnalysis] ÂºÄÂßãËß£ÊûêÊâÄÊúâ‰∫§Êòì"),console.log("[RuleMatchAnalysis] processedData ÈïøÂ∫¶:",((a=M.processedData)==null?void 0:a.length)||0),!M.processedData)return console.log("[RuleMatchAnalysis] processedData ‰∏∫Á©∫"),[];const s=[],o=M.processedData.split(`
`);console.log("[RuleMatchAnalysis] ÊÄªË°åÊï∞:",o.length);let r=null,t=!1;for(let u=0;u<o.length;u++){const v=o[u],A=v.trim();if(/^\d{4}-\d{2}-\d{2}\s+\*/.test(A)){r&&(s.push(r),console.log("[RuleMatchAnalysis] ÂÆåÊàê‰∏ÄÁ¨î‰∫§Êòì:",r));const f=A.match(/^(\d{4}-\d{2}-\d{2})\s+\*\s+"([^"]*)"\s+"([^"]*)"/);f&&(r={date:f[1],payee:f[2],narration:f[3],metadata:{},accounts:[],matchStatus:"matched",fixmeCount:0},t=!0,console.log(`[RuleMatchAnalysis] ÂºÄÂßãÊñ∞‰∫§Êòì: ${r.date} ${r.payee}`))}else if(t&&r&&v.trim()&&/^\s+[A-Za-z:]+\s+[-]?\d+(?:\.\d+)?\s+\w+/.test(v)){const f=v.match(/^\s+([A-Za-z:]+)\s+([-]?\d+(?:\.\d+)?)\s+(\w+)/);if(f){const I=f[1],X=f[2],L=I.includes("FIXME");r.accounts.push({account:I,amount:X,isFIXME:L}),L&&r.fixmeCount++,console.log(`[RuleMatchAnalysis] Ê∑ªÂä†Ë¥¶Êà∑: ${I} ${X} (FIXME: ${L})`)}else console.log("[RuleMatchAnalysis] Ë¥¶Êà∑Ë°åÂåπÈÖçÂ§±Ë¥•:",v.substring(0,80))}else if(t&&r&&v.trim()&&/^\s+\w+:/.test(v)){const f=v.match(/^\s+(\w+):\s*"?([^"]*)"?$/);f&&(r.metadata[f[1]]=f[2],console.log(`[RuleMatchAnalysis] Ê∑ªÂä†ÂÖÉÊï∞ÊçÆ: ${f[1]} = ${f[2]}`))}else t&&!A&&(r&&r.accounts.length>0&&(r.fixmeCount===0?r.matchStatus="matched":r.fixmeCount>=r.accounts.length?r.matchStatus="unmatched":r.matchStatus="partial",s.push(r),console.log("[RuleMatchAnalysis] ÂÆåÊàê‰∏ÄÁ¨î‰∫§Êòì:",r)),r=null,t=!1)}return r&&r.accounts.length>0&&(r.fixmeCount===0?r.matchStatus="matched":r.fixmeCount>=r.accounts.length?r.matchStatus="unmatched":r.matchStatus="partial",s.push(r),console.log("[RuleMatchAnalysis] ÂÆåÊàêÊúÄÂêé‰∏ÄÁ¨î‰∫§Êòì:",r)),console.log("[RuleMatchAnalysis] Ëß£ÊûêÂÆåÊàêÔºåÂÖ±",s.length,"Á¨î‰∫§Êòì"),console.log("[RuleMatchAnalysis] ‰∫§ÊòìÂàóË°®:",s),s}),i=m(()=>{const s=[...l.value].sort((o,r)=>{const t={unmatched:0,partial:1,matched:2};return t[o.matchStatus]-t[r.matchStatus]});return console.log("[RuleMatchAnalysis] ÊéíÂ∫èÂêéÁöÑ‰∫§Êòì:",s),s}),k=m(()=>l.value.length),n=m(()=>l.value.filter(s=>s.matchStatus==="unmatched").length),y=m(()=>l.value.filter(s=>s.matchStatus==="partial").length),_=m(()=>l.value.filter(s=>s.matchStatus==="matched").length);console.log("[RuleMatchAnalysis] ÁªüËÆ°:",{total:k.value,unmatched:n.value,partial:y.value,matched:_.value});const P=m(()=>{if(k.value===0)return console.log("[RuleMatchAnalysis] totalCount ‰∏∫ 0ÔºåË¶ÜÁõñÁéáËøîÂõû 0"),0;const s=_.value/k.value*100;return console.log("[RuleMatchAnalysis] Ë¶ÜÁõñÁéá:",s.toFixed(2)+"%"),s}),p=m(()=>{const s=P.value;return s>=90?"text-green-600 dark:text-green-400":s>=70?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}),w=m(()=>{const s=P.value;return s>=90?"bg-gradient-to-r from-green-500 to-emerald-500":s>=70?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-red-500 to-pink-500"}),b=s=>({unmatched:"bg-red-50 dark:bg-red-900/10 border-red-300 dark:border-red-700",partial:"bg-yellow-50 dark:bg-yellow-900/10 border-yellow-300 dark:border-yellow-700",matched:"bg-green-50 dark:bg-green-900/10 border-green-300 dark:border-green-700"})[s],x=s=>({unmatched:"bg-red-500 dark:bg-red-600 text-white",partial:"bg-yellow-500 dark:bg-yellow-600 text-white",matched:"bg-green-500 dark:bg-green-600 text-white"})[s],C=s=>({unmatched:"‚ùå Êú™ÂåπÈÖç",partial:"‚ö†Ô∏è ÂçäÂåπÈÖç",matched:"‚úÖ ÂÖ®ÂåπÈÖç"})[s],R=m(()=>{const s=[];if(n.value>0||y.value>0){const o=new Map,r=new Map;if(l.value.filter(t=>t.matchStatus==="unmatched"||t.matchStatus==="partial").forEach(t=>{t.payee&&t.payee!=="/"&&o.set(t.payee,(o.get(t.payee)||0)+1),t.metadata.type&&r.set(t.metadata.type,(r.get(t.metadata.type)||0)+1)}),o.size>0){const t=Array.from(o.entries()).sort((a,u)=>u[1]-a[1])[0];t[1]>1&&s.push(`ÂèëÁé∞ ${t[1]} Á¨îÊù•Ëá™"${t[0]}"ÁöÑ‰∫§ÊòìÈúÄË¶ÅÈÖçÁΩÆÔºåÂª∫ËÆÆÊ∑ªÂä†ÈíàÂØπËØ•‰∫§ÊòìÂØπÊâãÁöÑËßÑÂàô`)}if(r.size>0){const t=Array.from(r.entries()).sort((a,u)=>u[1]-a[1])[0];t[1]>1&&s.push(`ÂèëÁé∞ ${t[1]} Á¨î"${t[0]}"Á±ªÂûãÁöÑ‰∫§ÊòìÈúÄË¶ÅÈÖçÁΩÆÔºåÂª∫ËÆÆÊ∑ªÂä†ÈíàÂØπËØ•Á±ªÂûãÁöÑËßÑÂàô`)}n.value>k.value*.3&&s.push(`ÂΩìÂâçËßÑÂàôË¶ÜÁõñÁéáËæÉ‰ΩéÔºà${P.value.toFixed(1)}%ÔºâÔºåÂª∫ËÆÆ‰ºòÂÖàÈÖçÁΩÆÂ∏∏ËßÅÁöÑ‰∫§ÊòìÂØπÊâãÂíåÂàÜÁ±ªËßÑÂàô`),n.value+y.value>5&&s.push("Âª∫ËÆÆ‰ΩøÁî®ÈÄöÈÖçÁ¨¶ÊàñÊ≠£ÂàôË°®ËææÂºèÂåπÈÖçÁõ∏‰ººÁöÑ‰∫§ÊòìÔºåÈÅøÂÖç‰∏∫ÊØèÁ¨î‰∫§ÊòìÂçïÁã¨ÈÖçÁΩÆËßÑÂàô"),y.value>0&&s.push(`Êúâ ${y.value} Á¨î‰∫§Êòì‰ªÖÈÉ®ÂàÜÂåπÈÖçÔºåÂª∫ËÆÆÂÆåÂñÑËøô‰∫õ‰∫§ÊòìÁöÑËßÑÂàôÈÖçÁΩÆ`)}return s}),E=s=>{navigator.clipboard.writeText(s).then(()=>{console.log("Â∑≤Â§çÂà∂:",s)})};return(s,o)=>(d(),g("div",le,[e("div",ae,[o[2]||(o[2]=e("h3",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"ËßÑÂàôÂåπÈÖçÂàÜÊûê",-1)),e("button",{onClick:o[0]||(o[0]=r=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...o[1]||(o[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",ne,[e("div",ie,[e("div",de,[e("div",null,[o[3]||(o[3]=e("p",{class:"text-sm font-medium text-blue-600 dark:text-blue-400 mb-1"},"ÊÄªË¥¶ÂçïÊï∞",-1)),e("p",ue,c(k.value),1)]),o[4]||(o[4]=e("div",{class:"bg-blue-500 dark:bg-blue-600 rounded-full p-3"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1))])]),e("div",ce,[e("div",ge,[e("div",null,[o[5]||(o[5]=e("p",{class:"text-sm font-medium text-green-600 dark:text-green-400 mb-1"},"ÂÖ®ÂåπÈÖç",-1)),e("p",ve,c(_.value),1)]),o[6]||(o[6]=e("div",{class:"bg-green-500 dark:bg-green-600 rounded-full p-3"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",me,[e("div",pe,[e("div",null,[o[7]||(o[7]=e("p",{class:"text-sm font-medium text-yellow-600 dark:text-yellow-400 mb-1"},"ÂçäÂåπÈÖç",-1)),e("p",be,c(y.value),1)]),o[8]||(o[8]=e("div",{class:"bg-yellow-500 dark:bg-yellow-600 rounded-full p-3"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1))])]),e("div",xe,[e("div",fe,[e("div",null,[o[9]||(o[9]=e("p",{class:"text-sm font-medium text-red-600 dark:text-red-400 mb-1"},"Êú™ÂåπÈÖç",-1)),e("p",ye,c(n.value),1)]),o[10]||(o[10]=e("div",{class:"bg-red-500 dark:bg-red-600 rounded-full p-3"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])])]),e("div",he,[e("div",ke,[o[11]||(o[11]=e("span",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"ËßÑÂàôË¶ÜÁõñÁéá",-1)),e("span",{class:B(["text-2xl font-bold",p.value])},c(P.value.toFixed(1))+"%",3)]),e("div",we,[e("div",{class:B(["absolute top-0 left-0 h-full rounded-full transition-all duration-500",w.value]),style:G({width:`${P.value}%`})},null,6)]),e("p",_e,c(_.value)+" Á¨îÂÖ®ÂåπÈÖçÔºå"+c(y.value)+" Á¨îÂçäÂåπÈÖçÔºå"+c(n.value)+" Á¨îÊú™ÂåπÈÖç ",1)]),i.value.length>0?(d(),g("div",Ce,[o[13]||(o[13]=e("div",{class:"flex items-center justify-between mb-4"},[e("h4",{class:"text-xl font-bold text-gray-900 dark:text-white"},"‰∫§ÊòìÊòéÁªÜ"),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"}," ÁÇπÂáªË¥¶Êà∑ÂèØÂ§çÂà∂ÔºåFIXME Ê†áËÆ∞ÈúÄË¶ÅÈÖçÁΩÆËßÑÂàô ")],-1)),e("div",$e,[(d(!0),g(T,null,D(i.value,(r,t)=>(d(),g("div",{key:t,class:B(["rounded-xl p-4 hover:shadow-lg transition-all duration-200 border-2",b(r.matchStatus)])},[e("div",Me,[e("span",{class:B(["inline-flex items-center px-3 py-1 rounded-full text-xs font-bold",x(r.matchStatus)])},c(C(r.matchStatus)),3),e("span",Pe,c(r.date),1)]),e("div",Re,[e("div",Be,[o[12]||(o[12]=e("svg",{class:"w-5 h-5 text-gray-500 dark:text-gray-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("div",je,[e("p",Se,c(r.payee),1),r.narration&&r.narration!=="/"?(d(),g("p",Fe,c(r.narration),1)):h("",!0)])])]),e("div",ze,[(d(!0),g(T,null,D(r.accounts,(a,u)=>(d(),g("div",{key:u,class:B(["flex items-center justify-between text-sm font-mono p-2 rounded-lg",a.isFIXME?"bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700":"bg-gray-50 dark:bg-gray-800/50"])},[e("button",{onClick:v=>E(a.account),class:B(["flex-1 text-left truncate transition-colors",a.isFIXME?"text-red-700 dark:text-red-300 hover:text-red-900 dark:hover:text-red-100 font-bold":"text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"]),title:`ÁÇπÂáªÂ§çÂà∂Ôºö${a.account}`},c(a.isFIXME?"‚ö†Ô∏è ":"")+c(a.account),11,Ae),e("span",{class:B(["ml-2 flex-shrink-0 font-semibold",parseFloat(a.amount)<0?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"])},c(a.amount),3)],2))),128))]),Object.keys(r.metadata).length>0?(d(),g("details",Te,[e("summary",De," Êü•ÁúãËØ¶ÊÉÖ ("+c(Object.keys(r.metadata).length)+" È°π) ",1),e("div",Ve,[(d(!0),g(T,null,D(r.metadata,(a,u)=>(d(),g("div",{key:u,class:"flex gap-2"},[e("span",Ee,c(u)+":",1),e("span",Ie,c(a),1)]))),128))])])):h("",!0)],2))),128))])])):h("",!0),R.value.length>0?(d(),g("div",Le,[o[14]||(o[14]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-6 h-6 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h4",{class:"text-lg font-bold text-yellow-900 dark:text-yellow-100"},"‰ºòÂåñÂª∫ËÆÆ")],-1)),e("ul",Xe,[(d(!0),g(T,null,D(R.value,(r,t)=>(d(),g("li",{key:t,class:"flex items-start gap-2 text-sm text-yellow-800 dark:text-yellow-200"},[e("span",Ue,c(t+1),1),e("span",null,c(r),1)]))),128))])])):h("",!0),n.value===0&&k.value>0?(d(),g("div",Ne,[...o[15]||(o[15]=[e("svg",{class:"w-16 h-16 text-green-500 dark:text-green-400 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("h4",{class:"text-xl font-bold text-green-900 dark:text-green-100 mb-2"},"üéâ ÂÆåÁæéÔºÅ",-1),e("p",{class:"text-green-700 dark:text-green-300"},"ÊâÄÊúâË¥¶ÂçïÈÉΩÂ∑≤ÊàêÂäüÂåπÈÖçËßÑÂàôÔºÅ",-1)])])):h("",!0)]))}}),He={class:"w-full min-h-screen bg-gray-50 dark:bg-gray-900 px-6 sm:px-12 lg:px-24 py-8"},qe={class:"flex items-center justify-between mb-8"},We={class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6"},Ze={class:"flex items-center justify-between mb-4"},Ge={key:1,class:"p-4 bg-gray-50 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-700"},Je={key:0,class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6"},Ke={key:1,class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6"},Qe={class:"flex gap-6"},Ye={class:"flex items-center gap-2 cursor-pointer"},et={class:"flex items-center gap-2 cursor-pointer"},tt={key:2,class:"mb-6"},rt={class:"flex flex-wrap gap-4"},ot=["disabled"],st={key:0,class:"w-7 h-7 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},lt={key:1,class:"w-7 h-7 mr-3 animate-spin",fill:"none",viewBox:"0 0 24 24"},at={key:3,class:"mb-6 p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg"},nt={class:"flex items-center"},it={class:"text-red-800 dark:text-red-200 font-medium"},dt={key:4,class:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6"},ut={class:"mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},ct={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},gt={class:"ml-2 font-medium text-gray-900 dark:text-white"},vt={class:"ml-2 font-medium text-gray-900 dark:text-white"},mt={class:"ml-2 font-medium text-gray-900 dark:text-white"},pt={class:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg text-sm overflow-x-auto max-h-96 overflow-y-auto font-mono text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700"},bt={key:6,class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/10 border border-blue-200 dark:border-blue-800 rounded-lg"},_t=W({__name:"DegBillProcessingView",setup($){const j=te(),M=K(),l=Z(),i=se(),k=z(!0),n=m(()=>l.currentProvider.value),y=m(()=>{const r=l.supportedProviders.value;return r.length===0?q.filter(t=>["alipay","wechat","icbc","ccb","citic","cmb","huobi","htsec","hxsec","mt","jd","bmo","td","hsbchk"].includes(t.type)):r.map(t=>q.find(u=>u.type===t)).filter(t=>t!==void 0)}),_=m(()=>i.selectedFile.value),P=m(()=>i.isProcessing.value),p=m(()=>i.processingResult.value),w=m(()=>i.error.value||l.error.value),b=m({get:()=>i.outputFormat.value,set:r=>{i.outputFormat.value=r}}),x=async r=>{try{console.log(`[BillProcessing] ÂºÄÂßãÂàáÊç¢ provider Âà∞: ${r}`),console.log(`[BillProcessing] Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî® setProvider: ${r}`);const t=await l.setProvider(r);console.log("[BillProcessing] setProvider ÁªìÊûú:",t),await new Promise(u=>setTimeout(u,100));let a=F.getConfig(r);if(a||(a=F.getDefaultConfig(r)),a)try{console.log(`[BillProcessing] Á¨¨‰∫åÊ¨°Ë∞ÉÁî® setProvider: ${r}`);const u=await l.setProvider(r);console.log("[BillProcessing] setProvider ÁªìÊûú:",u),await new Promise(v=>setTimeout(v,100)),console.log(`[BillProcessing] Ë∞ÉÁî® updateConfigÔºåprovider: ${r}`),await l.updateConfig(V.parse(a),r),console.log("[BillProcessing] updateConfig ÂÆåÊàê")}catch(u){console.warn("Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ:",u),await l.setProvider(r),await new Promise(A=>setTimeout(A,100));const v=F.getDefaultConfig(r);await l.updateConfig(V.parse(v),r)}else console.log("[BillProcessing] Ê≤°ÊúâÈÖçÁΩÆÊñá‰ª∂ÔºåÂè™ËÆæÁΩÆ provider");console.log(`[BillProcessing] provider ÂàáÊç¢ÂÆåÊàê: ${r}`)}catch(t){console.error("ËÆæÁΩÆ Provider Â§±Ë¥•:",t),i.error.value=`ËÆæÁΩÆ Provider Â§±Ë¥•: ${t instanceof Error?t.message:String(t)}`}},C=r=>{i.selectedFile.value=r,i.error.value=null,r||(i.processingResult.value=null)},R=async()=>{if(!_.value||!n.value){i.error.value="ËØ∑ÈÄâÊã©Êñá‰ª∂ÂíåËß£ÊûêÂô®";return}console.log(`[BillProcessing] ÂºÄÂßãÂ§ÑÁêÜÊñá‰ª∂ÔºåÂΩìÂâç provider: ${n.value}`),await i.processFile(_.value,b.value)},E=async()=>{var r;if((r=p.value)!=null&&r.output){const t=await i.copyToClipboard(p.value.output);alert(t?"Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ":"Â§çÂà∂Â§±Ë¥•")}},s=()=>{const r=b.value==="beancount"?"beancount":"ledger";i.downloadResult(`output.${r}`)},o=()=>{n.value?j.push({path:"/rule-config",query:{provider:n.value,from:"bill-processing"}}):j.push({path:"/rule-config",query:{from:"bill-processing"}})};return J(async()=>{try{await l.init(),await new Promise(t=>setTimeout(t,200));const r=M.query.provider;if(r?await l.setProvider(r):l.supportedProviders.value.length>0?await l.setProvider(l.supportedProviders.value[0]):y.value.length>0&&await l.setProvider(y.value[0].type),n.value){await l.setProvider(n.value),await new Promise(a=>setTimeout(a,50));let t=F.getConfig(n.value);if(t||(t=F.getDefaultConfig(n.value)),t)try{await l.updateConfig(V.parse(t),n.value),await l.setProvider(n.value),await new Promise(a=>setTimeout(a,50))}catch(a){console.warn("Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ:",a),await l.setProvider(n.value),await new Promise(v=>setTimeout(v,50));const u=F.getDefaultConfig(n.value);await l.updateConfig(V.parse(u),n.value),await l.setProvider(n.value),await new Promise(v=>setTimeout(v,50))}}}catch(r){console.error("ÂàùÂßãÂåñÂ§±Ë¥•:",r);const t=r instanceof Error?r.message:String(r);i.error.value=`WASM ÂàùÂßãÂåñÂ§±Ë¥•: ${t}„ÄÇËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï`}finally{k.value=!1}}),(r,t)=>{const a=Y("router-link");return d(),g("div",He,[e("div",qe,[t[3]||(t[3]=e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"Ë¥¶ÂçïÂ§ÑÁêÜ",-1)),N(a,{to:"/",class:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-gray-900 dark:hover:text-white transition-colors"},{default:Q(()=>[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),S(" ËøîÂõûÈ¶ñÈ°µ ",-1)])]),_:1})]),e("div",We,[e("div",Ze,[t[5]||(t[5]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"ÈÄâÊã©Ëß£ÊûêÂô®",-1)),n.value?(d(),g("button",{key:0,onClick:o,class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-purple-600 dark:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 rounded-md transition-colors",title:"Ë∑≥ËΩ¨Âà∞ËßÑÂàôÈÖçÁΩÆÈ°µÈù¢"},[...t[4]||(t[4]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),S(" ÈÖçÁΩÆËßÑÂàô ",-1)])])):h("",!0)]),y.value.length>0?(d(),U(re,{key:0,"supported-providers":y.value,"selected-provider":n.value,onProviderSelected:x},null,8,["supported-providers","selected-provider"])):(d(),g("div",Ge,[...t[6]||(t[6]=[e("p",{class:"text-gray-600 dark:text-gray-400 text-sm"},"Ê≠£Âú®Âä†ËΩΩËß£ÊûêÂô®ÂàóË°®...",-1)])]))]),n.value?(d(),g("div",Je,[t[7]||(t[7]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"‰∏ä‰º†Ë¥¶ÂçïÊñá‰ª∂",-1)),N(oe,{"selected-file":_.value,"detected-provider":null,onFileSelected:C},null,8,["selected-file"])])):h("",!0),n.value?(d(),g("div",Ke,[t[10]||(t[10]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"ËæìÂá∫Ê†ºÂºè",-1)),e("div",Qe,[e("label",Ye,[O(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=u=>b.value=u),value:"beancount",class:"w-4 h-4 text-blue-600 focus:ring-blue-500"},null,512),[[H,b.value]]),t[8]||(t[8]=e("span",{class:"text-gray-700 dark:text-gray-300"},"Beancount",-1))]),e("label",et,[O(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=u=>b.value=u),value:"ledger",class:"w-4 h-4 text-blue-600 focus:ring-blue-500"},null,512),[[H,b.value]]),t[9]||(t[9]=e("span",{class:"text-gray-700 dark:text-gray-300"},"Ledger",-1))])])])):h("",!0),_.value&&n.value?(d(),g("div",tt,[e("div",rt,[e("button",{onClick:R,disabled:P.value||!_.value,class:"inline-flex items-center px-12 py-5 text-xl font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-2xl shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-blue-600"},[P.value?(d(),g("svg",lt,[...t[12]||(t[12]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(d(),g("svg",st,[...t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])),S(" "+c(P.value?"Â§ÑÁêÜ‰∏≠...":`ÁîüÊàê ${b.value==="beancount"?"Beancount":"Ledger"}`),1)],8,ot),e("button",{onClick:o,class:"inline-flex items-center px-12 py-5 text-xl font-bold bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 hover:border-gray-400 dark:hover:border-gray-500 rounded-2xl shadow-xl transition-all duration-200"},[...t[13]||(t[13]=[e("svg",{class:"w-7 h-7 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),S(" ËßÑÂàôÈÖçÁΩÆ ",-1)])])])])):h("",!0),w.value?(d(),g("div",at,[e("div",nt,[t[14]||(t[14]=e("svg",{class:"w-5 h-5 text-red-600 dark:text-red-400 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",it,c(w.value),1)])])):h("",!0),p.value&&p.value.success?(d(),g("div",dt,[e("div",{class:"flex items-center justify-between mb-4"},[t[17]||(t[17]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Â§ÑÁêÜÁªìÊûú",-1)),e("div",{class:"flex gap-2"},[e("button",{onClick:E,class:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[...t[15]||(t[15]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),S(" Â§çÂà∂ ",-1)])]),e("button",{onClick:s,class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors"},[...t[16]||(t[16]=[e("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),S(" ‰∏ãËΩΩ ",-1)])])])]),e("div",ut,[e("div",ct,[e("div",null,[t[18]||(t[18]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Ê†ºÂºè:",-1)),e("span",gt,c(p.value.format||b.value),1)]),e("div",null,[t[19]||(t[19]=e("span",{class:"text-gray-600 dark:text-gray-400"},"‰∫§ÊòìÊï∞:",-1)),e("span",vt,c(p.value.transactions||0),1)]),e("div",null,[t[20]||(t[20]=e("span",{class:"text-gray-600 dark:text-gray-400"},"Provider:",-1)),e("span",mt,c(p.value.provider),1)])])]),e("pre",pt,c(p.value.output),1)])):h("",!0),p.value&&p.value.success&&p.value.output?(d(),U(Oe,{key:5,"processed-data":p.value.output,"total-records":p.value.transactions||0},null,8,["processed-data","total-records"])):h("",!0),k.value?(d(),g("div",bt,[...t[21]||(t[21]=[ee('<div class="flex items-center"><svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-2 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span class="text-blue-800 dark:text-blue-200 font-medium">Ê≠£Âú®ÂàùÂßãÂåñ WASM Ê®°Âùó...</span></div>',1)])])):h("",!0)])}}});export{_t as default};
